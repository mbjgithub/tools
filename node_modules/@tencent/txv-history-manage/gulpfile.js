var vfe = require('vfe')
var gulp = require('gulp')
var deploy = require('vfe-deploy')
var eslint = require('gulp-eslint')

gulp.task('default', [clean()], function () {
  vfe({
    entry: './index.js',
    hash: false,
    output: {
      filename: 'release.js'
    }
  }).pipe(gulp.dest('./dist'))
})

function clean() {
  var name = 'clean_dist'
  gulp.task(name, function () {
    gulp.src('./dist/*.js', { read: false }).pipe(vfe.clean())
  })
  return name
}

gulp.task('release', function () {
  deploy({
    src: ['dist/release.js'],
    base: 'dist',
    host: '10.123.9.9:8997',
    path: '/usr/local/imgcache/htdocs/tencentvideo/script/quick-open/'
  }, function (err) {
    if (err) console.log(err)
  })
})

gulp.task('lint', function () {
  return gulp.src(['./index.js', './lib/**/*.js'])
    .pipe(eslint())
    .pipe(eslint.format())
    .pipe(eslint.failAfterError())
})