var vfe = require('vfe')
var gulp = require('gulp')
var inject = require('gulp-inject')

gulp.task('default',[clean()],function() {
	var filter = vfe.filter(function(file) {
		return !/\.min\.js$/.test(file.path)
	})
	gulp.src('./test.vue')
		.pipe(inject(vfe({
			entry: './test.js',
			hash: false,
			output: {
				filename: "rtest.js"
			},
			resolve: {
				alias: {
					'vue$': 'vue/dist/vue.common.js'
				}
			}
		}).pipe(gulp.dest('dist/')).pipe(filter), {
			transform: function(filename, file) {
				return "<script type='text/javascript'>" + file.contents.toString('utf8') + "</script>"
			}
		})).pipe(gulp.dest('./'))
})

function clean(){
	var task_name="clean_test_dist"
    gulp.task(task_name,function(){
    	gulp.src(['dist/*.js'],{read:false}).pipe(vfe.clean())
    })
    return task_name
} 