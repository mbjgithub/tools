var historyManage = require('../index')
var Vue = require('vue')

var app = new Vue({
	el: "#app",
	data: {
		cur: "",
		pn: "",
		cid_vid: "",
		cid: "",
		vid: "",
		time: "",
		left_list: [],
		right_list: []
	},

  watch: {
    cid_vid: function(newValue) {
      newValue = newValue || ''
      if (!newValue) {
        this.vid = this.cid = ''
      } else {
        var arr = newValue.split('_')
        this.cid = arr[0] || '';
        this.vid = arr[1] || '';
      }
    }
  },

	methods: {
		get: function(e) {
			var that = this
			var data
			if (this.cid_vid) {
				data = this.cid_vid.split("|")
			} else if (this.cur && this.pn) {
				data = {
					pn: parseInt(this.pn),
					cur: parseInt(this.cur)
				}
			} else {
				data = {
					cid: this.cid,
					vid: this.vid
				}
			}
			historyManage.get(data, function(err, resData) {
				if (err) {
					resData = [{
						msg: "从服务器拉取历史记录错误"
					}]
				}

				that.left_list = format(data, resData)
			})
		},
		getSync: function(e) {
			var temp={
				cid: this.cid,
				vid: this.vid
			}
			var data = historyManage.getSync(temp)

			this.right_list = format(temp,data)
		},
		set: function() {
			var flag = historyManage.set({
				cid: this.cid,
				vid: this.vid,
				time: this.time
			})
			flag ? alert("设置成功") :
				alert('设置失败')
		}
	}
})

function format(data, resData) {
	var res = []
	if (data.cid || data.vid) {
		res.push(resData)
	} else {
		for (var key in resData) {
			res.push(resData[key])
		}
	}
	return res
}