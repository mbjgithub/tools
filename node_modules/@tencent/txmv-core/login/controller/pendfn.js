'use strict';

module.exports = function (fn) {
	var queue = [];
	var pending = false;
	return function (cb) {
		if (arguments.length == 1 && typeof cb == 'function') { // 只有单回调函数才合并
			queue.push(cb);
			if (!pending) {
				pending = true;
				fn.call(this, function () {
					pending = false;
					var callback;
					while(callback = queue.pop()) {
						callback.apply(this, arguments);
					}
				});
			}
		} else {
			return fn.apply(this, arguments);
		}
	}
};