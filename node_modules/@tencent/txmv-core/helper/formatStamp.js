'use strict';
/**
 * 将时间戳转化为微博/贴吧式时间显示
 * stamp 目标时间戳
 * now 当前时间戳
 */

module.exports = function (stamp, now) {
	var zeroStamp = new Date;
	zeroStamp.setHours(0);
	zeroStamp.setMinutes(0);
	zeroStamp.setSeconds(0);
	zeroStamp = zeroStamp.getTime() / 1000;
	var gap = (now || (Date.now() / 1000)) - stamp;


	if (gap < 60) {
		return '刚刚'
	} else if (gap < 3600) {
		return Math.floor(gap / 60) + '分钟前'

	} else if (gap < 24 * 3600 && stamp >= zeroStamp) {
		// 如果超过一小时，要判断该日期是否在当前自然日内。若是，则显示小时数
		return Math.floor(gap / 3600) + '小时前'

	} else if (gap < 2 * 24 * 3600 && stamp < zeroStamp) {
		// 如果不在当前自然日内，则显示昨天。
		return '昨天'

	} else if (gap < 7 * 24 * 3600) {
		// 在一周内的，则显示X天前
		return Math.floor(gap / (24 * 3600)) + '天前'

	} else {
		// 否则，显示yyyy-MM-dd
		stamp = new Date(stamp * 1000);
		var month = stamp.getMonth() + 1;
		month = month >= 10 ? month : '0' + month;
		var date = stamp.getDate();
		date = date >= 10 ? date : '0' + date;
		return [stamp.getFullYear(), '-', month, '-', date].join('');
	}
};