/**
 * 将jQuery或Zepto的deferred修正成W3C标准的Promise，并种到全局。
 * 使用方式：
 * require('txmv-core/polyfill/promise-JqToEs');
 * 注：自行保证页面中已有 $.Deferred();
 */
'use strict';
var $ = window.jQuery || window.Zepto || (window.tvp && window.tvp.$) || (window.Txplayer && window.Txplayer.$);
if (!$) {
	console.error('该组件依赖于window.jQuery或window.Zepto');
}

window.Promise = function(fn) {
	var def = $.Deferred();
	fn(def.resolve.bind(def), def.reject.bind(def));
	return def.promise();
};


window.Promise.defer = function() {
	var def = $.Deferred();
	def.__promise = def.promise;
	Object.defineProperty(def, 'promise', {
		get: function() {
			return def.__promise();
		},
		set: function() {}
	});
	return def;
};
window.Promise.all = function (array) {
	return $.when.apply($, array);
};

window.Promise.resolve = function () {
	var def = $.Deferred();
	def.resolve();
	return def;
};

window.Promise.reject = function () {
	var def = $.Deferred();
	def.reject();
	return def;
};